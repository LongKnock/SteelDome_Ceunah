<!-- <?xml version="1.0" encoding="utf-8"?> -->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="turret_description">

  <xacro:property name="PI" value="3.1415926535897931"/>
  <xacro:property name="joint_effort" value="100.0"/>
  <xacro:property name="joint_velocity" value="3.14"/>
  <xacro:property name="joint_damping" value="0.1"/>
  <xacro:property name="joint_friction" value="0.1"/>

  <material name="grey">
    <color rgba="0.52941 0.54902 0.54902 1"/>
  </material>

  <link name="world"/>
  <joint name="world_fixed" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <link name="base_link">
    <inertial>
      <origin xyz="-0.059907 1.301E-17 0.022839" rpy="0 0 0" />
      <mass value="0.28603" />
      <!-- <inertia ixx="0.00013769" ixy="-5.3945E-19" ixz="-3.2506E-21" iyy="0.00013769" iyz="5.6125E-20" izz="0.00022916" /> -->
      <inertia ixx="0.00013769" ixy="0.0" ixz="0.0" iyy="0.00013769" iyz="0.0" izz="0.00022916" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://turret_description/meshes/base_link.STL" />
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://turret_description/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>

  <link name="Horizontal_Link">
    <inertial>
      <origin xyz="-0.0013345 1.7795E-05 0.0067059" rpy="0 0 0" />
      <mass value="0.059322" />
      <!-- <inertia ixx="4.4326E-06" ixy="5.8533E-09" ixz="8.3795E-07" iyy="4.8715E-06" iyz="-1.1174E-08" izz="3.5927E-06" /> -->
      <inertia ixx="4.4326E-06" ixy="0.0" ixz="8.3795E-07" iyy="4.8715E-06" iyz="0.0" izz="3.5927E-06" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://turret_description/meshes/Horizontal_Link.STL" />
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://turret_description/meshes/Horizontal_Link.STL" />
      </geometry>
    </collision>
  </link>

  <!-- <joint name="Horizontal_Joint" type="continuous">
    <origin xyz="-0.059907 0 0.038897" rpy="0 0 0" />
    <parent link="base_link" />
    <child link="Horizontal_Link" />
    <axis xyz="0 0 1" />
    <dynamics damping="${joint_damping}" friction="${joint_friction}" />
  </joint> -->

  <joint name="Horizontal_Joint" type="revolute"> <origin xyz="-0.059907 0 0.038897" rpy="0 0 0" />
      <parent link="base_link" />
      <child link="Horizontal_Link" />
      <axis xyz="0 0 1" />
      <limit lower="-3.14" upper="3.14" effort="${joint_effort}" velocity="${joint_velocity}" />
      <dynamics damping="${joint_damping}" friction="${joint_friction}" />
  </joint>

  <link name="Vertical_Link">
    <inertial>
      <origin xyz="0.013867 0.027537 -1.0361E-08" rpy="0 0 0" />
      <mass value="0.664" />
      <!-- <inertia ixx="0.00023872" ixy="5.5153E-05" ixz="-3.4476E-11" iyy="0.0011211" iyz="-5.0832E-12" izz="0.0011439" /> -->
      <inertia ixx="0.00023872" ixy="5.5153E-05" ixz="0.0" iyy="0.0011211" iyz="0.0" izz="0.0011439" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://turret_description/meshes/Vertical_Link.STL" />
      </geometry>
      <material name="grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://turret_description/meshes/Vertical_Link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="Vertical_Joint" type="revolute">
    <origin xyz="-0.014074 0.00018767 0.020525" rpy="1.5708 0 -0.013334" />
    <parent link="Horizontal_Link" />
    <child link="Vertical_Link" />
    <axis xyz="0 0 -1" />
    <limit lower="-0.262" upper="0.785" effort="${joint_effort}" velocity="${joint_velocity}" />
    <dynamics damping="${joint_damping}" friction="${joint_friction}" />
  </joint>

  <link name="camera_link">
      <visual>
        <geometry>
          <box size="0.01 0.01 0.01"/>
        </geometry>
        <material name="black"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.01 0.01 0.01"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.1"/>
        <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>
      </inertial>
    </link>

  <joint name="camera_fixed_joint" type="fixed">
    <parent link="Vertical_Link"/>
    <child link="camera_link"/>
    <origin xyz="0.0 0.08 0.0" rpy="0 0 0"/>
  </joint>

  <link name="camera_optical_frame"/>

  <joint name="camera_optical_joint" type="fixed">
    <parent link="camera_link"/>
    <child link="camera_optical_frame"/>
    <origin xyz="0 0 0" rpy="-1.5708 0 -1.5708"/> 
  </joint>
  <!-- <gazebo reference="base_link">
    <material>Gazebo/Grey</material>
  </gazebo>
  <gazebo reference="Horizontal_Link">
    <material>Gazebo/Grey</material>
  </gazebo>
  <gazebo reference="Vertical_Link">
    <material>Gazebo/Grey</material>
    </gazebo> -->
<gazebo reference="base_link">
    <material>
      <ambient>0.53 0.55 0.55 1</ambient>
      <diffuse>0.53 0.55 0.55 1</diffuse>
      <specular>0.1 0.1 0.1 1</specular>
      <emissive>0 0 0 1</emissive>
    </material>
  </gazebo>

  <gazebo reference="Horizontal_Link">
    <material>
      <ambient>0.53 0.55 0.55 1</ambient>
      <diffuse>0.53 0.55 0.55 1</diffuse>
      <specular>0.1 0.1 0.1 1</specular>
    </material>
  </gazebo>

  <gazebo reference="Vertical_Link">
    <material>
      <ambient>0.53 0.55 0.55 1</ambient>
      <diffuse>0.53 0.55 0.55 1</diffuse>
      <specular>0.1 0.1 0.1 1</specular>
    </material>
  </gazebo>

<gazebo reference="camera_link">
  <sensor type="camera" name="camera_sensor">
    <always_on>1</always_on>
    <update_rate>30.0</update_rate>

    <camera name="camera">
      <horizontal_fov>1.047</horizontal_fov>
      <image>
        <width>640</width>
        <height>480</height>
        <format>R8G8B8</format>
      </image>
      <clip>
          <near>0.02</near>
          <far>300</far>
      </clip>
      <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.007</stddev>
      </noise>
    </camera>

    <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
      <ros>
        <namespace>/turret</namespace>
        <remapping>image_raw:=/camera/image_raw</remapping>
        <remapping>camera_info:=/camera/camera_info</remapping>
      </ros>
      <camera_name>camera</camera_name>
      <frame_name>camera_optical_frame</frame_name>
      <hack_baseline>0.07</hack_baseline>
    </plugin>
  </sensor>
</gazebo>

<gazebo>
  <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so">
    <parameters>$(find turret_simulation)/config/turret_controllers.yaml</parameters>
    <ros>
      <remapping>robot_description:=robot_description</remapping>
    </ros>
  </plugin>
</gazebo>

<ros2_control name="GazeboSystem" type="system">
  <hardware>
    <plugin>gazebo_ros2_control/GazeboSystem</plugin>
  </hardware>
  <joint name="Horizontal_Joint">
    <command_interface name="position"/>
    <command_interface name="velocity"/>
    <state_interface name="position"/>
    <state_interface name="velocity"/>
    </joint>
  <joint name="Vertical_Joint">
    <command_interface name="position"/>
    <command_interface name="velocity"/>
    <state_interface name="position"/>
    <state_interface name="velocity"/>
    </joint>
</ros2_control>

</robot>